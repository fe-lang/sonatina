---
source: crates/codegen/tests/evm.rs
assertion_line: 153
expression: "String::from_utf8(v).unwrap()"
input_file: test_files/evm/backedge_prefer.sntn
---
// func public %entry()
  block0 P=[] T=[]
    - stack=[]
      pre: [PUSH_CONT, PUSH(22), PUSH(11)]
      call [11, 22] -> v0
    - stack=[v0], last_use=[v0]
      pre: [PUSH(0)]
      mstore [0, v0]
    - stack=[]
      pre: [PUSH(4), PUSH(0)]
      evm_return [0, 4]

// func private %prefer_backedge_layout(v0.i32, v1.i32) -> i32
  block0 P=[v0, v1] T=[]
    - stack=[v0, v1, <RET>]
      exit(block1): [SWAP1, PUSH(0)]
      jump -> block1
  block1 P=[v2] T=[v1, v0]
    - stack=[v2, v1, v0, <RET>]
      pre: [PUSH(3), DUP2]
      lt [v2, 3] -> v3
    - stack=[v3, v2, v1, v0, <RET>]
      br [v3] -> [block2, block4]
  block2 P=[] T=[v2, v1, v0]
    inherited from block1: [v2, v1, v0, <RET>]
    - stack=[v2, v1, v0, <RET>]
      pre: [DUP2, DUP4]
      add [v0, v1] -> v4
    - stack=[v4x, v2, v1, v0, <RET>], last_use=[v2]
      cleanup: [POP]
      pre: [PUSH(1)]
      add [1, v2] -> v5
    - stack=[v5, v1, v0, <RET>]
      jump -> block3
  block3 P=[] T=[v5, v1, v0]
    - stack=[v5, v1, v0, <RET>]
      jump -> block1
  block4 P=[] T=[v2]
    inherited from block1: [v2, v1x, v0x, <RET>]
    prologue: [SWAP1, SWAP2, POP, SWAP1, POP]
    - stack=[v2, <RET>]
      return [v2]

// func public %entry()
entry:
  block0:
    JUMPDEST
    PUSH1 `pc + (5)`  // v0.i32 = call %prefer_backedge_layout 11.i32 22.i32;
    PUSH1 0x16 (22)
    PUSH1 0xb (11)
    PUSH1 FuncRef(1)
    JUMP
    JUMPDEST
    PUSH0  // mstore 0.i32 v0 i32;
    SWAP1
    PUSH1 0xe0 (224)
    SHL
    SWAP1
    MSTORE
    PUSH1 0x4 (4)  // evm_return 0.i8 4.i8;
    PUSH0
    RETURN

// func private %prefer_backedge_layout(v0.i32, v1.i32) -> i32
prefer_backedge_layout:
  block0:
    JUMPDEST
    SWAP1  // jump block1;
    PUSH0
  block1:
    JUMPDEST
    PUSH1 0x3 (3)  // v3.i1 = lt v2 3.i32;
    DUP2
    LT
    ISZERO  // br v3 block2 block4;
    PUSH1 block4
    JUMPI
  block2:
    JUMPDEST
    DUP2  // v4.i32 = add v0 v1;
    DUP4
    ADD
    POP  // v5.i32 = add v2 1.i32;
    PUSH1 0x1 (1)
    ADD
  block3:
    JUMPDEST
    PUSH1 block1  // jump block1;
    JUMP
  block4:
    JUMPDEST
    SWAP1  // return v2;
    SWAP2
    POP
    SWAP1
    POP
    SWAP1
    JUMP



---------------

// func public %entry()
entry:
  block0:
    0    JUMPDEST
    1    PUSH1 10  // v0.i32 = call %prefer_backedge_layout 11.i32 22.i32;
    3    PUSH1 0x16 (22)
    5    PUSH1 0xb (11)
    7    PUSH1 22 (FuncRef(1))
    9    JUMP
   10    JUMPDEST
   11    PUSH0  // mstore 0.i32 v0 i32;
   12    SWAP1
   13    PUSH1 0xe0 (224)
   15    SHL
   16    SWAP1
   17    MSTORE
   18    PUSH1 0x4 (4)  // evm_return 0.i8 4.i8;
   20    PUSH0
   21    RETURN
// func private %prefer_backedge_layout(v0.i32, v1.i32) -> i32
prefer_backedge_layout:
  block0:
   22    JUMPDEST
   23    SWAP1  // jump block1;
   24    PUSH0
  block1:
   25    JUMPDEST
   26    PUSH1 0x3 (3)  // v3.i1 = lt v2 3.i32;
   28    DUP2
   29    LT
   30    ISZERO  // br v3 block2 block4;
   31    PUSH1 46 (block4)
   33    JUMPI
  block2:
   34    JUMPDEST
   35    DUP2  // v4.i32 = add v0 v1;
   36    DUP4
   37    ADD
   38    POP  // v5.i32 = add v2 1.i32;
   39    PUSH1 0x1 (1)
   41    ADD
  block3:
   42    JUMPDEST
   43    PUSH1 25 (block1)  // jump block1;
   45    JUMP
  block4:
   46    JUMPDEST
   47    SWAP1  // return v2;
   48    SWAP2
   49    POP
   50    SWAP1
   51    POP
   52    SWAP1
   53    JUMP

0x5b600a6016600b6016565b5f9060e01b905260045ff35b905f5b6003811015602e575b818301506001015b6019565b90915090509056

Success { reason: Return, gas_used: 21328, gas_refunded: 0, logs: [], output: Call(0x00000003) }

    pc  opcode            input (stack grows to the right)
     0  5b  JUMPDEST      []
     1  60  PUSH1         0x0a  []
     3  60  PUSH1         0x16  [0xa]
     5  60  PUSH1         0x0b  [0xa, 0x16]
     7  60  PUSH1         0x16  [0xa, 0x16, 0xb]
     9  56  JUMP          [0xa, 0x16, 0xb, 0x16]
    22  5b  JUMPDEST      [0xa, 0x16, 0xb]
    23  90  SWAP1         [0xa, 0x16, 0xb]
    24  5f  PUSH0         [0xa, 0xb, 0x16]
    25  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x0]
    26  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x0]
    28  81  DUP2          [0xa, 0xb, 0x16, 0x0, 0x3]
    29  10  LT            [0xa, 0xb, 0x16, 0x0, 0x3, 0x0]
    30  15  ISZERO        [0xa, 0xb, 0x16, 0x0, 0x1]
    31  60  PUSH1         0x2e  [0xa, 0xb, 0x16, 0x0, 0x0]
    33  57  JUMPI         [0xa, 0xb, 0x16, 0x0, 0x0, 0x2e]
    34  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x0]
    35  81  DUP2          [0xa, 0xb, 0x16, 0x0]
    36  83  DUP4          [0xa, 0xb, 0x16, 0x0, 0x16]
    37  01  ADD           [0xa, 0xb, 0x16, 0x0, 0x16, 0xb]
    38  50  POP           [0xa, 0xb, 0x16, 0x0, 0x21]
    39  60  PUSH1         0x01  [0xa, 0xb, 0x16, 0x0]
    41  01  ADD           [0xa, 0xb, 0x16, 0x0, 0x1]
    42  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x1]
    43  60  PUSH1         0x19  [0xa, 0xb, 0x16, 0x1]
    45  56  JUMP          [0xa, 0xb, 0x16, 0x1, 0x19]
    25  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x1]
    26  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x1]
    28  81  DUP2          [0xa, 0xb, 0x16, 0x1, 0x3]
    29  10  LT            [0xa, 0xb, 0x16, 0x1, 0x3, 0x1]
    30  15  ISZERO        [0xa, 0xb, 0x16, 0x1, 0x1]
    31  60  PUSH1         0x2e  [0xa, 0xb, 0x16, 0x1, 0x0]
    33  57  JUMPI         [0xa, 0xb, 0x16, 0x1, 0x0, 0x2e]
    34  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x1]
    35  81  DUP2          [0xa, 0xb, 0x16, 0x1]
    36  83  DUP4          [0xa, 0xb, 0x16, 0x1, 0x16]
    37  01  ADD           [0xa, 0xb, 0x16, 0x1, 0x16, 0xb]
    38  50  POP           [0xa, 0xb, 0x16, 0x1, 0x21]
    39  60  PUSH1         0x01  [0xa, 0xb, 0x16, 0x1]
    41  01  ADD           [0xa, 0xb, 0x16, 0x1, 0x1]
    42  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x2]
    43  60  PUSH1         0x19  [0xa, 0xb, 0x16, 0x2]
    45  56  JUMP          [0xa, 0xb, 0x16, 0x2, 0x19]
    25  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x2]
    26  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x2]
    28  81  DUP2          [0xa, 0xb, 0x16, 0x2, 0x3]
    29  10  LT            [0xa, 0xb, 0x16, 0x2, 0x3, 0x2]
    30  15  ISZERO        [0xa, 0xb, 0x16, 0x2, 0x1]
    31  60  PUSH1         0x2e  [0xa, 0xb, 0x16, 0x2, 0x0]
    33  57  JUMPI         [0xa, 0xb, 0x16, 0x2, 0x0, 0x2e]
    34  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x2]
    35  81  DUP2          [0xa, 0xb, 0x16, 0x2]
    36  83  DUP4          [0xa, 0xb, 0x16, 0x2, 0x16]
    37  01  ADD           [0xa, 0xb, 0x16, 0x2, 0x16, 0xb]
    38  50  POP           [0xa, 0xb, 0x16, 0x2, 0x21]
    39  60  PUSH1         0x01  [0xa, 0xb, 0x16, 0x2]
    41  01  ADD           [0xa, 0xb, 0x16, 0x2, 0x1]
    42  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x3]
    43  60  PUSH1         0x19  [0xa, 0xb, 0x16, 0x3]
    45  56  JUMP          [0xa, 0xb, 0x16, 0x3, 0x19]
    25  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x3]
    26  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x3]
    28  81  DUP2          [0xa, 0xb, 0x16, 0x3, 0x3]
    29  10  LT            [0xa, 0xb, 0x16, 0x3, 0x3, 0x3]
    30  15  ISZERO        [0xa, 0xb, 0x16, 0x3, 0x0]
    31  60  PUSH1         0x2e  [0xa, 0xb, 0x16, 0x3, 0x1]
    33  57  JUMPI         [0xa, 0xb, 0x16, 0x3, 0x1, 0x2e]
    46  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x3]
    47  90  SWAP1         [0xa, 0xb, 0x16, 0x3]
    48  91  SWAP2         [0xa, 0xb, 0x3, 0x16]
    49  50  POP           [0xa, 0x16, 0x3, 0xb]
    50  90  SWAP1         [0xa, 0x16, 0x3]
    51  50  POP           [0xa, 0x3, 0x16]
    52  90  SWAP1         [0xa, 0x3]
    53  56  JUMP          [0x3, 0xa]
    10  5b  JUMPDEST      [0x3]
    11  5f  PUSH0         [0x3]
    12  90  SWAP1         [0x3, 0x0]
    13  60  PUSH1         0xe0  [0x0, 0x3]
    15  1b  SHL           [0x0, 0x3, 0xe0]
    16  90  SWAP1         [0x0, 0x300000000000000000000000000000000000000000000000000000000]
    17  52  MSTORE        [0x300000000000000000000000000000000000000000000000000000000, 0x0]
    18  60  PUSH1         0x04  []
    20  5f  PUSH0         [0x4]
    21  f3  RETURN        [0x4, 0x0]
