---
source: crates/codegen/tests/evm.rs
assertion_line: 152
expression: "String::from_utf8(v).unwrap()"
input_file: test_files/evm/backedge_prefer.sntn
---
// func public %entry()
  block0 P=[] T=[]
    - stack=[]
      pre: [PUSH_CONT, PUSH(22), PUSH(11)]
      call [11, 22] -> v0
    - stack=[v0], last_use=[v0]
      pre: [PUSH(0)]
      mstore [0, v0]
    - stack=[]
      pre: [PUSH(32), PUSH(0)]
      evm_return [0, 32]

// func private %prefer_backedge_layout(v0.i32, v1.i32) -> i32
  block0 P=[v0, v1] T=[]
    - stack=[v0, v1, <RET>]
      exit(block1): [SWAP1, PUSH(0)]
      jump -> block1
  block1 P=[v2] T=[v1, v0]
    - stack=[v2, v1, v0, <RET>]
      pre: [PUSH(3), DUP2]
      lt [v2, 3] -> v3
    - stack=[v3, v2, v1, v0, <RET>]
      br [v3] -> [block2, block4]
  block2 P=[] T=[v2, v1, v0]
    inherited from block1: [v2, v1, v0, <RET>]
    - stack=[v2, v1, v0, <RET>]
      pre: [DUP2, DUP4]
      add [v0, v1] -> v4
    - stack=[v4x, v2, v1, v0, <RET>], last_use=[v2]
      cleanup: [POP]
      pre: [PUSH(1)]
      add [1, v2] -> v5
    - stack=[v5, v1, v0, <RET>]
      jump -> block3
  block3 P=[] T=[v5, v1, v0]
    - stack=[v5, v1, v0, <RET>]
      jump -> block1
  block4 P=[] T=[v2]
    inherited from block1: [v2, v1x, v0x, <RET>]
    prologue: [SWAP1, POP, SWAP1, POP]
    - stack=[v2, <RET>]
      return [v2]

// func public %entry()
entry:
  block0:
    JUMPDEST
    PUSH1 `pc + (5)`  // v0.i32 = call %prefer_backedge_layout 11.i32 22.i32;
    PUSH1 0x16 (22)
    PUSH1 0xb (11)
    PUSH1 FuncRef(1)
    JUMP
    JUMPDEST
    PUSH0  // mstore 0.i32 v0 i32;
    MSTORE
    PUSH1 0x20 (32)  // evm_return 0.i8 32.i8;
    PUSH0
    RETURN

// func private %prefer_backedge_layout(v0.i32, v1.i32) -> i32
prefer_backedge_layout:
  block0:
    JUMPDEST
    SWAP1  // jump block1;
    PUSH0
  block1:
    JUMPDEST
    PUSH1 0x3 (3)  // v3.i1 = lt v2 3.i32;
    DUP2
    LT
    ISZERO  // br v3 block2 block4;
    PUSH1 block4
    JUMPI
  block2:
    JUMPDEST
    DUP2  // v4.i32 = add v0 v1;
    DUP4
    ADD
    POP  // v5.i32 = add v2 1.i32;
    PUSH1 0x1 (1)
    ADD
  block3:
    JUMPDEST
    PUSH1 block1  // jump block1;
    JUMP
  block4:
    JUMPDEST
    SWAP1  // return v2;
    POP
    SWAP1
    POP
    SWAP1
    JUMP



---------------

// func public %entry()
entry:
  block0:
    0    JUMPDEST
    1    PUSH1 10  // v0.i32 = call %prefer_backedge_layout 11.i32 22.i32;
    3    PUSH1 0x16 (22)
    5    PUSH1 0xb (11)
    7    PUSH1 17 (FuncRef(1))
    9    JUMP
   10    JUMPDEST
   11    PUSH0  // mstore 0.i32 v0 i32;
   12    MSTORE
   13    PUSH1 0x20 (32)  // evm_return 0.i8 32.i8;
   15    PUSH0
   16    RETURN
// func private %prefer_backedge_layout(v0.i32, v1.i32) -> i32
prefer_backedge_layout:
  block0:
   17    JUMPDEST
   18    SWAP1  // jump block1;
   19    PUSH0
  block1:
   20    JUMPDEST
   21    PUSH1 0x3 (3)  // v3.i1 = lt v2 3.i32;
   23    DUP2
   24    LT
   25    ISZERO  // br v3 block2 block4;
   26    PUSH1 41 (block4)
   28    JUMPI
  block2:
   29    JUMPDEST
   30    DUP2  // v4.i32 = add v0 v1;
   31    DUP4
   32    ADD
   33    POP  // v5.i32 = add v2 1.i32;
   34    PUSH1 0x1 (1)
   36    ADD
  block3:
   37    JUMPDEST
   38    PUSH1 20 (block1)  // jump block1;
   40    JUMP
  block4:
   41    JUMPDEST
   42    SWAP1  // return v2;
   43    POP
   44    SWAP1
   45    POP
   46    SWAP1
   47    JUMP

0x5b600a6016600b6011565b5f5260205ff35b905f5b60038110156029575b818301506001015b6014565b905090509056

Success { reason: Return, gas_used: 21313, gas_refunded: 0, logs: [], output: Call(0x0000000000000000000000000000000000000000000000000000000000000003) }

    pc  opcode            input (stack grows to the right)
     0  5b  JUMPDEST      []
     1  60  PUSH1         0x0a  []
     3  60  PUSH1         0x16  [0xa]
     5  60  PUSH1         0x0b  [0xa, 0x16]
     7  60  PUSH1         0x11  [0xa, 0x16, 0xb]
     9  56  JUMP          [0xa, 0x16, 0xb, 0x11]
    17  5b  JUMPDEST      [0xa, 0x16, 0xb]
    18  90  SWAP1         [0xa, 0x16, 0xb]
    19  5f  PUSH0         [0xa, 0xb, 0x16]
    20  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x0]
    21  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x0]
    23  81  DUP2          [0xa, 0xb, 0x16, 0x0, 0x3]
    24  10  LT            [0xa, 0xb, 0x16, 0x0, 0x3, 0x0]
    25  15  ISZERO        [0xa, 0xb, 0x16, 0x0, 0x1]
    26  60  PUSH1         0x29  [0xa, 0xb, 0x16, 0x0, 0x0]
    28  57  JUMPI         [0xa, 0xb, 0x16, 0x0, 0x0, 0x29]
    29  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x0]
    30  81  DUP2          [0xa, 0xb, 0x16, 0x0]
    31  83  DUP4          [0xa, 0xb, 0x16, 0x0, 0x16]
    32  01  ADD           [0xa, 0xb, 0x16, 0x0, 0x16, 0xb]
    33  50  POP           [0xa, 0xb, 0x16, 0x0, 0x21]
    34  60  PUSH1         0x01  [0xa, 0xb, 0x16, 0x0]
    36  01  ADD           [0xa, 0xb, 0x16, 0x0, 0x1]
    37  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x1]
    38  60  PUSH1         0x14  [0xa, 0xb, 0x16, 0x1]
    40  56  JUMP          [0xa, 0xb, 0x16, 0x1, 0x14]
    20  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x1]
    21  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x1]
    23  81  DUP2          [0xa, 0xb, 0x16, 0x1, 0x3]
    24  10  LT            [0xa, 0xb, 0x16, 0x1, 0x3, 0x1]
    25  15  ISZERO        [0xa, 0xb, 0x16, 0x1, 0x1]
    26  60  PUSH1         0x29  [0xa, 0xb, 0x16, 0x1, 0x0]
    28  57  JUMPI         [0xa, 0xb, 0x16, 0x1, 0x0, 0x29]
    29  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x1]
    30  81  DUP2          [0xa, 0xb, 0x16, 0x1]
    31  83  DUP4          [0xa, 0xb, 0x16, 0x1, 0x16]
    32  01  ADD           [0xa, 0xb, 0x16, 0x1, 0x16, 0xb]
    33  50  POP           [0xa, 0xb, 0x16, 0x1, 0x21]
    34  60  PUSH1         0x01  [0xa, 0xb, 0x16, 0x1]
    36  01  ADD           [0xa, 0xb, 0x16, 0x1, 0x1]
    37  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x2]
    38  60  PUSH1         0x14  [0xa, 0xb, 0x16, 0x2]
    40  56  JUMP          [0xa, 0xb, 0x16, 0x2, 0x14]
    20  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x2]
    21  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x2]
    23  81  DUP2          [0xa, 0xb, 0x16, 0x2, 0x3]
    24  10  LT            [0xa, 0xb, 0x16, 0x2, 0x3, 0x2]
    25  15  ISZERO        [0xa, 0xb, 0x16, 0x2, 0x1]
    26  60  PUSH1         0x29  [0xa, 0xb, 0x16, 0x2, 0x0]
    28  57  JUMPI         [0xa, 0xb, 0x16, 0x2, 0x0, 0x29]
    29  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x2]
    30  81  DUP2          [0xa, 0xb, 0x16, 0x2]
    31  83  DUP4          [0xa, 0xb, 0x16, 0x2, 0x16]
    32  01  ADD           [0xa, 0xb, 0x16, 0x2, 0x16, 0xb]
    33  50  POP           [0xa, 0xb, 0x16, 0x2, 0x21]
    34  60  PUSH1         0x01  [0xa, 0xb, 0x16, 0x2]
    36  01  ADD           [0xa, 0xb, 0x16, 0x2, 0x1]
    37  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x3]
    38  60  PUSH1         0x14  [0xa, 0xb, 0x16, 0x3]
    40  56  JUMP          [0xa, 0xb, 0x16, 0x3, 0x14]
    20  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x3]
    21  60  PUSH1         0x03  [0xa, 0xb, 0x16, 0x3]
    23  81  DUP2          [0xa, 0xb, 0x16, 0x3, 0x3]
    24  10  LT            [0xa, 0xb, 0x16, 0x3, 0x3, 0x3]
    25  15  ISZERO        [0xa, 0xb, 0x16, 0x3, 0x0]
    26  60  PUSH1         0x29  [0xa, 0xb, 0x16, 0x3, 0x1]
    28  57  JUMPI         [0xa, 0xb, 0x16, 0x3, 0x1, 0x29]
    41  5b  JUMPDEST      [0xa, 0xb, 0x16, 0x3]
    42  90  SWAP1         [0xa, 0xb, 0x16, 0x3]
    43  50  POP           [0xa, 0xb, 0x3, 0x16]
    44  90  SWAP1         [0xa, 0xb, 0x3]
    45  50  POP           [0xa, 0x3, 0xb]
    46  90  SWAP1         [0xa, 0x3]
    47  56  JUMP          [0x3, 0xa]
    10  5b  JUMPDEST      [0x3]
    11  5f  PUSH0         [0x3]
    12  52  MSTORE        [0x3, 0x0]
    13  60  PUSH1         0x20  []
    15  5f  PUSH0         [0x20]
    16  f3  RETURN        [0x20, 0x0]
